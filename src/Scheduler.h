//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
// 
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Lesser General Public License for more details.
// 
// You should have received a copy of the GNU Lesser General Public License
// along with this program.  If not, see http://www.gnu.org/licenses/.
// 

#ifndef __SCHED_TST_SCHEDULER_H_
#define __SCHED_TST_SCHEDULER_H_

#include <omnetpp.h>

using namespace omnetpp;

/**
 * TODO - Generated class
 */


class User{
public:
    User(int index, int weight)
    {
        this->index = index;
        if(index <= 1){
            this->weight = 9;
        }else
        if(index > 1 && index <= 6)
        {
             this->weight = 4;
        }else
        {
            this->weight = 1;
        }

        this->lastTimeServed = -1.0f;
        this->queueLength = 0;
        for(int i = 0; i < 30; ++i)
        {
            this->radioLinksQuality[i] = linksQuality[30*index+i];
        }
    }

    int addQueueLength()
    {
        this->queueLength++;
        return this->queueLength;
    }

    int decrementQueueLength(int subtrahend)
    {
        this->queueLength -= subtrahend;
        return this->queueLength;
    }

    int getQueueLength()
    {
        return this->queueLength;
    }

    double updateLastTimeServed(double currentSimTime)
    {
        this->lastTimeServed = currentSimTime;
        return this->lastTimeServed;
    }

    double getCurrentPriority(double currentSimTime, int channelNumber)
    {
        double priority = static_cast<double>(this->weight * (currentSimTime - this->lastTimeServed) * radioLinksQuality[channelNumber]);
        return priority;
    }

    int getUserIndex()
    {
        return this->index;
    }

    int getUserWeight()
        {
            return this->weight;
        }
private:
    User();
    int index;
//    double linksQuality[300] = {0.19001754358140038, 0.07484274645565152, 0.1050885934629026, 0.813897942146842, 0.5338905910287552, 0.45837491373273165, 0.4268508326709717, 0.36846978716530454, 0.611789287020261, 0.7965197655558666, 0.5096541169662226, 0.5331584796108717, 0.4779317675185984, 0.4693826499410931, 0.3298984884691321, 0.4404805758764158, 0.8546892485778198, 0.13112273285149204, 0.9301567089384303, 0.1551856895231207, 0.35710020251892627, 0.6051941295517079, 0.5807459170154137, 0.7568678179518379, 0.03438806754841823, 0.5144151475124429, 0.10101454570894465, 0.5067303087718268, 0.15177689318685944, 0.22830053386184315, 0.5096782013078377, 0.5650180508946134, 0.6111253873395545, 0.5472336839702922, 0.13589914438360431, 0.09278327743773376, 0.5123142257090364, 0.557989476176588, 0.4724217136390785, 0.3187139095727938, 0.576279329759324, 0.27709831877677665, 0.04988258399013081, 0.6888123087342617, 0.07976396742624631, 0.6838286047784263, 0.5195285470571407, 0.3435207402506217, 0.49816822389817417, 0.7961724342155525, 0.9181865762554107, 0.9022055159434359, 0.37214799261698417, 0.9192949520601652, 0.36859373125517986, 0.6661195818016659, 0.8638303623517141, 0.7504329986697639, 0.022824945941284747, 0.2579166655295581, 0.5802503274352613, 0.3406026351091729, 0.3295979768968601, 0.7913532910505526, 0.9057845347147958, 0.47219748996472327, 0.8613567036705323, 0.0601112558433744, 0.3687662740030946, 0.15567743483570962, 0.19823440859156752, 0.18681055471612312, 0.7605898124010624, 0.16203437544070276, 0.9608013715218574, 0.498217235711024, 0.4189674944832263, 0.30722937093544384, 0.6273775548313526, 0.7808268343167215, 0.5901493000777617, 0.7030459658386866, 0.9086975767716763, 0.7516692345580321, 0.5262859907804935, 0.35108231295826425, 0.9448937337691248, 0.5173634973224367, 0.6658193101464098, 0.8458213416307927, 0.21227027728570147, 0.5187671982823941, 0.6095893292721897, 0.08254560281497897, 0.16822250855778853, 0.6292666143207486, 0.08729235120696277, 0.440304317329734, 0.1449660793541734, 0.814161968843049};
    double linksQuality[300] = {0.9957364549416228,
                0.055710308956982924,
                0.2614345147405408,
                0.22812089275793357,
                0.8886400165657165,
                0.5360792620628492,
                0.4856172939743706,
                0.2629151406602803,
                0.5123452472557636,
                0.5386716554323903,
                0.8248082840436379,
                0.20013664967604106,
                0.9442448871518122,
                0.6859692178019863,
                0.7518861495910462,
                0.28715061662036356,
                0.09664922099397122,
                0.19727180144712475,
                0.5831754963857942,
                0.8536165283311902,
                0.933676597816257,
                0.474117407572197,
                0.309009546088298,
                0.2290687306007636,
                0.8956751667011951,
                0.41300604177857947,
                0.14421860358982286,
                0.10363393353585693,
                0.6812448520223352,
                0.4828132462406476,
                0.5873603578035579,
                0.8190492647092983,
                0.27457894407325045,
                0.9758795509114591,
                0.44742844878923616,
                0.09084266596527024,
                0.39908970502187624,
                0.6284728270744113,
                0.3823908693943019,
                0.5204835980309859,
                0.2712266362702138,
                0.6988129975417493,
                0.9415013117410207,
                0.3493839183506465,
                0.004774248642666623,
                0.795075084208642,
                0.05732838298392662,
                0.8114899713718211,
                0.20176123581510363,
                0.3272251460564929,
                0.030994402592334103,
                0.22809629095303852,
                0.5566194769569549,
                0.028844691248719467,
                0.9236795442920227,
                0.9007407802920118,
                0.04850509076270426,
                0.5546269428932017,
                0.11022449602601803,
                0.45263857998067014,
                0.9342235244989473,
                0.9101346441733044,
                0.1613202722712147,
                0.07636587571024256,
                0.4683362827850698,
                0.7682893954369439,
                0.21481568710223098,
                0.4826668921089854,
                0.9891006003712255,
                0.7685548379595976,
                0.6497965808943068,
                0.4464862050511793,
                0.12059445499088706,
                0.8939712611772525,
                0.15094925065562714,
                0.11879686136172252,
                0.7742985414778326,
                0.22107214570184375,
                0.08998301322364732,
                0.2885595758912056,
                0.9266359338625219,
                0.45696142452922506,
                0.8044161690721154,
                0.4998800699740399,
                0.7396451870106645,
                0.43333342434948563,
                0.47149570574780775,
                0.12353233194368762,
                0.29541734955215837,
                0.9066413046291343,
                0.6808088512724961,
                0.013661460355625099,
                0.9117272953681267,
                0.3854881016330052,
                0.8806271768594306,
                0.42039948586768827,
                0.04785255462166882,
                0.9739534070710069,
                0.22891948463764566,
                0.3427076438324228,
                0.6503143521194029,
                0.4837351860860648,
                0.848187014259238,
                0.21054992122235605,
                0.26470064623528056,
                0.021890641654867427,
                0.21414754212223241,
                0.6278163081193047,
                0.514000264834542,
                0.5877806773891002,
                0.2499287157107115,
                0.801647494551553,
                0.9708973826952662,
                0.20031079823450804,
                0.34274521302644334,
                0.1905396821985621,
                0.3887293817648416,
                0.7065582424878623,
                0.06306470662428842,
                0.0300531456096349,
                0.757722170237324,
                0.7641732501968922,
                0.6840132168946171,
                0.10062445785922125,
                0.16515361160088027,
                0.6810190775723052,
                0.5300767375184677,
                0.8781975010868931,
                0.23843763376106697,
                0.927251015723815,
                0.6332614274712575,
                0.9590559452189006,
                0.434820743843193,
                0.5820183201052638,
                0.5040751012310817,
                0.43716883098351,
                0.6920726274587916,
                0.1635935952260834,
                0.23153243629907072,
                0.9172349922442189,
                0.8021534183147881,
                0.19972840345992904,
                0.3582458325915415,
                0.7847253732228983,
                0.5687267937161363,
                0.6503257378609191,
                0.2321846440442915,
                0.2978633102548841,
                0.9343138890446014,
                0.6553515558515294,
                0.6744646634130392,
                0.04220163036126534,
                0.762430932520458,
                0.9134407043768704,
                0.7786044151472559,
                0.5059988788957569,
                0.5003410531466413,
                0.5272775189013361,
                0.9711390449463239,
                0.3363850613703616,
                0.0978922277991141,
                0.07535701274076301,
                0.7596451696222104,
                0.11876934412983609,
                0.6248896536731066,
                0.32459866843995544,
                0.24202302429668354,
                0.48460190766527855,
                0.2491951350707119,
                0.9999883745551217,
                0.30743082066553584,
                0.47191373839666517,
                0.34519277745657195,
                0.039419942990257306,
                0.1675032603826082,
                0.6435443422231933,
                0.1801196772699124,
                0.1055397998482146,
                0.48306011663280235,
                0.2801386750602969,
                0.2933937155453106,
                0.7091123235506359,
                0.6158031506054028,
                0.7726170701617943,
                0.48163870071476156,
                0.18467393542856037,
                0.07101449976645668,
                0.37900281546537096,
                0.5624970501659319,
                0.29089224326926455,
                0.6676048022670639,
                0.9782550801817714,
                0.9721217038755424,
                0.27397740429657813,
                0.9988864986250305,
                0.22255630642454916,
                0.10315563231857505,
                0.6171716882082253,
                0.7067313692773128,
                0.4857729143963416,
                0.25987312848621147,
                0.3328145423679433,
                0.05515424377856115,
                0.39452348192060405,
                0.7589513858929755,
                0.03186474408225448,
                0.8869376736439567,
                0.7775828338486895,
                0.7742778610096883,
                0.7312821796566747,
                0.9200219394490171,
                0.745426601265288,
                0.20039118240004694,
                0.411514353365394,
                0.062499598857573946,
                0.32477665557433555,
                0.9367000129709471,
                0.6331577957370669,
                0.6671999655311309,
                0.14217549902646975,
                0.010260280581750436,
                0.8549522709147462,
                0.47041950843385105,
                0.1935521628352629,
                0.43452528132865664,
                0.2755264666257602,
                0.4687817308645955,
                0.10789853330366006,
                0.17319427212782434,
                0.7184386894151404,
                0.4545207057789191,
                0.9347687736999141,
                0.6316299402183223,
                0.6523159467813698,
                0.9568580008584662,
                0.21858826953346777,
                0.2570465339594066,
                0.606916587364934,
                0.016097189677483636,
                0.5785893595456694,
                0.1033195396195139,
                0.20459357749700446,
                0.7948083107424124,
                0.5947721127129891,
                0.8966407919142262,
                0.638417852526396,
                0.9041840839213946,
                0.18919150707058807,
                0.7571935514428975,
                0.44674713423345325,
                0.7109359020445968,
                0.5169927340168311,
                0.9680963663474182,
                0.09393565526975989,
                0.9117958342276822,
                0.5068853868968741,
                0.49730438133610566,
                0.6486442345010346,
                0.03215333108011875,
                0.8823081518157895,
                0.34412138301120987,
                0.7914843821660695,
                0.7679792013371972,
                0.871312529932847,
                0.3099827642110252,
                0.5058318567096578,
                0.049425803685369085,
                0.21162304317895075,
                0.588135873696066,
                0.31466896430360647,
                0.5836555354505742,
                0.4211475454178295,
                0.21919383315350516,
                0.6089069782956164,
                0.1664114264556752,
                0.4877414498178122,
                0.6510122924295326,
                0.8100438657399432,
                0.1184307664600317,
                0.44622449597414227,
                0.2998841832859305,
                0.8591246407419755,
                0.3669768550661937,
                0.7237093933846164,
                0.051265579842169506,
                0.9373893035008508,
                0.8203679924739099,
                0.324700251311662,
                0.7165114788593274,
                0.4809063285526354,
                0.010489624493199567,
                0.5097403941956811,
                0.6576781039268957,
                0.7946000858207857,
                0.4414703286521373,
                0.9075278448511139,
                0.31208956709518443,
                0.09247192146015348,
                0.6653776131093715,
                0.9878498891418123};
    double radioLinksQuality[30];
    int weight;
    int queueLength;
    double lastTimeServed;
    cRNG* randomNrGen;
};


class Scheduler : public cSimpleModule
{
public:
    Scheduler();
    ~Scheduler();
private:
    cMessage *selfMsg;
    int NrUsers;
    std::vector<User> users;
    int NrOfChannels;
  protected:
    virtual void initialize();
    virtual void handleMessage(cMessage *msg);
};

#endif
